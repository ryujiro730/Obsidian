## 🌟 目的

本プロジェクト（クオンツアルゴ開発）におけるコードベースの構造設計と、それぞれの役割・責務を明示する。モジュール単位で分割された構造により、保守性・再利用性・スケーラビリティを最大化する。

---

## 📁 ディレクトリ構成

```
quant_core/
├── __init__.py
│
├── feature_builder.py            # 特徴量全体のビルド（統合実行用）
│
├── features/
│   ├── __init__.py
│   ├── physical.py              # generate_physical_features (ベクトル化済)
│   ├── cosine.py                # compute_cosine_features（通貨間の類似）
│   └── macro.py                 # merge_macro_features（VIX/COT/金利）
│
├── label_generator.py            # ラベル生成（TP/SL、PIPS、未条件など）
├── strategy_executor.py          # STRATEGY_01 / 02の判定関数
├── deap_config.py                # 道線設計，個体生成，評価関数
├── backtest_runner.py            # 検証処理（TP/SLロジック適用）
├── model/
│   ├── __init__.py
│   └── xgb_trainer.py           # 特徴量とラベルを使ってXGBで学習＆評価
├── visualizer.py                # backtest_runnerの出力結果をグラフ化して保存
├── pipeline.py                  # 一括処理（DEAP→BT→グラフ保存を自動化）
├── __main__.py                  # CLIやローカル実行用
│
├── utils/
│   ├── __init__.py
│   ├── logger.py                # ログ整形（必要に応じて）
│   └── timer.py                 # 処理時間記録（tqdmで代用可）
```

---

## 🧰 各モジュールの責務と役割

### `feature_builder.py`
- 特徴量構築を一括実行するメインスクリプト
- 内容:
  - `generate_physical_features()` の並列呼び出し
  - `compute_cosine_features()` 呼び出し
  - `merge_macro_features()` によるマクロ統合
  - 結果の保存 (Parquet)

### `features/physical.py`
- 通貨別に速度・加速度・zscore・エネルギー系の特徴量を生成
- 全てベクトル化済 / 通貨ごの並列化可

### `features/cosine.py`
- 通貨間のClose/Open/High/Low類似度をcosine_similarityで測定
- 組合せごとに並列化可

### `features/macro.py`
- VIX, COT, 金利データを読み込み、15分足に統一
- `Datetime`をキーにマージ

### `label_generator.py`
- 各種ラベル生成用
  - TP/SL型, 固定PIPS, FAISS未条件型, 時間基準型

### `strategy_executor.py`
- STRATEGY_01 / STRATEGY_02のようなルール定義を格納
- DataFrameをマスクしてエントリーポイントを抽出

### `deap_config.py`
- DEAPベースの進化アルゴ設計
  - 道線定義，評価関数，個体構築，交叉，絶純など

### `backtest_runner.py`
- 評価目標に基づき、TP/SLで実際のバックテストを実行
- 費用、スプレッド、初期資産など取り入れ済

### `model/xgb_trainer.py`
- XGBoostでの学習、重要度評価、SHAPログなどを調整
- future: LightGBM への統一も検討可

### `visualizer.py`
- 資産推移グラフを自動生成&保存
- `save_equity_curve(df, path)` として使用

### `pipeline.py`
- DEAP検索 → BT → グラフ保存 をまとめて自動化
- 評価ログや通貨別のループも拡張可

### `__main__.py`
- CLI やローカル実行用スタートポイント
- `if __name__ == "__main__":` からテスト実行などに使用

### `utils/`
- ログ出力、時間記録等を分離して構造化

---

## 🔁 呼び出し関係（上流 → 下流）

```
feature_builder.py
├── features/
│   ├── physical.py
│   ├── cosine.py
│   └── macro.py

label_generator.py
strategy_executor.py
↓
deap_config.py
↓
backtest_runner.py
↓
visualizer.py
↓
pipeline.py
```

---

## ✅ 備考

- 各 `.py` ファイルは Obsidian の該当ノート（仕様書）と1:1で対応
- モジュールごとの単体テストも可能な構造
- 並列化は `joblib.Parallel` または `multiprocessing` で実装する前提

更新日：2025-05-07
