# éºä¼å­æ§‹é€ .md

## ğŸ¯ ç›®çš„
DEAPé€²åŒ–æˆ¦ç•¥ã§ä½¿ç”¨ã™ã‚‹ã€Œéºä¼å­ã€ã®å®šç¾©ã¨ãã®è¨­è¨ˆãƒ«ãƒ¼ãƒ«ã‚’è¨˜è¿°ã™ã‚‹ã€‚

---

## ğŸ§¬ éºä¼å­æ§‹é€ ï¼ˆFEATUREã”ã¨ã®ã—ãã„å€¤ï¼‹ä½¿ç”¨ãƒ•ãƒ©ã‚°ï¼‰

- 1ã¤ã®ç‰¹å¾´é‡ = `[threshold (float), use_flag (0 or 1)]`
- 1æˆ¦ç•¥ = `ç‰¹å¾´é‡æ•° Ã— 2` ã®éºä¼å­é•·ã‚’ã‚‚ã¤ list

### ä¾‹ï¼šå€‹ä½“ = [2.1, 1, 0.5, 0, 1.8, 1, -0.7, 1]  
â†’ æ„å‘³ï¼š

- zscore_20 > 2.1ï¼ˆä½¿ç”¨ã™ã‚‹ï¼‰
    
- volume_energy â†’ ä½¿ç”¨ã—ãªã„ï¼ˆ0ï¼‰
    
- momentum_10 > 1.8ï¼ˆä½¿ç”¨ã™ã‚‹ï¼‰
    
- velocity > -0.7ï¼ˆä½¿ç”¨ã™ã‚‹ï¼‰
    


from deap import base, creator, tools
import random

# éºä¼å­é•·ã‚’å®šç¾©ï¼ˆä¾‹ï¼š4ã¤ã®ç‰¹å¾´é‡ Ã— é–¾å€¤ã¨ä½¿ç”¨æœ‰ç„¡ï¼‰
FEATURES = ["zscore_20", "volume_energy", "momentum_10", "velocity"]

def generate_individual():
    individual = []
    for feat in FEATURES:
        threshold = random.uniform(-3.0, 3.0)  # é–¾å€¤ï¼ˆé€£ç¶šå¤‰æ•°ï¼‰
        use_flag = random.randint(0, 1)        # ä½¿ç”¨æœ‰ç„¡ï¼ˆãƒã‚¤ãƒŠãƒªï¼‰
        individual += [threshold, use_flag]
    return individual

# ä¾‹: å€‹ä½“ [2.1, 1, 0.5, 0, 1.8, 1, -0.7, 1]
# æ„å‘³:
# zscore_20 > 2.1ï¼ˆä½¿ç”¨ã™ã‚‹ï¼‰
# volume_energy â†’ ä½¿ç”¨ã—ãªã„ï¼ˆãƒ•ãƒ©ã‚°0ï¼‰
# momentum_10 > 1.8ï¼ˆä½¿ç”¨ã™ã‚‹ï¼‰
# velocity > -0.7ï¼ˆä½¿ç”¨ã™ã‚‹ï¼‰



## ğŸ¯ DEAPç™»éŒ²ï¼ˆFitness & å€‹ä½“å‹ï¼‰

creator.create("FitnessMulti", base.Fitness, weights=(1.0, 1.0, -0.5))  # å‹ç‡, RRæ¯”, MDD
creator.create("Individual", list, fitness=creator.FitnessMulti)

# ğŸ”§ toolboxç™»éŒ²
toolbox = base.Toolbox()
toolbox.register("individual", tools.initIterate, creator.Individual, generate_individual)
toolbox.register("population", tools.initRepeat, list, toolbox.individual)
toolbox.register("mate", tools.cxTwoPoint)
toolbox.register("mutate", tools.mutGaussian, mu=0, sigma=0.5, indpb=0.2)
toolbox.register("select", tools.selNSGA2)  # å¤šç›®çš„æœ€é©åŒ–


## ğŸ” è©•ä¾¡é–¢æ•°ã®æ¥ç¶š
def evaluate_strategy(individual):
    # ç‰¹å¾´é‡ã”ã¨ã®é–¾å€¤ã¨ä½¿ç”¨æœ‰ç„¡ã‚’åˆ†è§£
    rules = []
    for i, feat in enumerate(FEATURES):
        threshold = individual[i * 2]
        use_flag = individual[i * 2 + 1]
        if use_flag:
            rules.append((feat, threshold))
    
    # ã“ã“ã§ãƒ«ãƒ¼ãƒ«ã‚’å…ƒã«DataFrameã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‹ã‘ã€å‹ç‡ãªã©ã‚’ç®—å‡º
    # â†’ accuracy, rr, mdd ã‚’è¿”ã™
    return accuracy, rr, mdd
