# DEAP評価設計.md

## 🎯 目的

進化的アルゴリズム（DEAP）における個体（戦略ルール）の性能を定量的に評価する関数群の設計指針を定める。

---

## 📌 評価軸（スコア関数）一覧

### 1. 勝率（Accuracy）

- 定義：`勝ち件数 / 総トレード数`
    
- 目的：シンプルな成功率評価
    
- 注意：高勝率でも低リターンの場合あり → 単独使用は非推奨
    

### 2. リスクリワード比（Reward/Risk Ratio）

- 定義：`平均利益 / 平均損失`
    
- 目的：一回あたりのトレード効率を測る
    
- 注意：片側のみ突出しても過信不可。勝率と併用すべし
    

### 3. 平均リターン（Mean Return）

- 定義：`各トレードの損益の平均値`
    
- 目的：トータルパフォーマンス評価
    
- 注意：外れ値の影響を受けやすい
    

### 4. 最大ドローダウン（Max Drawdown）

- 定義：`資産曲線における最大ピークからの下落幅`
    
- 目的：リスク評価の基準。これが大きい戦略は実戦不可
    
- 評価：**マイナス要素としてペナルティ化（例：`-0.5 × MDD`）**
    

### 5. 総リターン（Total Return）

- 定義：`初期資産 → 最終資産の増減`
    
- 補足：複利を用いる場合、日次・週次で再計算する実装も検討
    

---

## 🧬 多目的最適化（Multi-Objective）

DEAP の `creator.FitnessMulti` を用い、以下の2軸以上で評価を行う：

```python
creator.create("FitnessMulti", base.Fitness, weights=(1.0, 1.0, -0.5))
```

- `(accuracy, reward/risk, -max_drawdown)` のように設定し、  
    高パフォーマンス・高効率・低リスクをバランス良く追求
    

---

## ⚠️ 実装時の注意点

- 0割回避：平均損失や分母が0の可能性がある項目には `+1e-9` 加算など安全策必須
    
- 試行回数が極端に少ない個体は強制スコア減点 or 除外
    
- 各指標を正規化 or スケーリングして同程度の重みで比較
    

---

## 今後の拡張候補

- シャープレシオ（リスクに対するリターン）
    
- 勝ちトレード連続回数の最長記録
    
- 時間帯別リターン分析（例：NY時間のみ）
    

---

更新日: 2025-05-07